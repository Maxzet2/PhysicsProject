<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Physics Project</title>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body>
    <div class="page">
      <nav class="nav">
        <div class="nav-title"><a href="/">Physics Project</a></div>
        <div class="actions" id="guestActions">
          <a class="btn" href="/login.html">–í–æ–π—Ç–∏</a>
          <a class="btn btn-secondary" href="/register.html">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
        <div class="actions" id="userActions" hidden>
          <span class="btn btn-secondary" style="gap: 0.5rem; min-width: auto;">
            üë§ <span id="userNameLabel"></span>
          </span>
          <a class="btn" id="startDemoBtn" href="/test-session.html">–ù–∞—á–∞—Ç—å –¥–µ–º–æ-—Ç–µ—Å—Ç</a>
          <button class="btn btn-secondary" id="profileBtn" type="button">–ü—Ä–æ—Ñ–∏–ª—å (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</button>
          <button class="btn btn-secondary" id="logoutBtn" type="button">–í—ã–π—Ç–∏</button>
        </div>
      </nav>

      <main class="hero">
        <section id="guestSection">
          <h1>–ü—Ä–∞–∫—Ç–∏–∫—É–º –ø–æ —Ñ–∏–∑–∏–∫–µ</h1>
          <p>
            –ü—Ä–æ—Ö–æ–¥–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–π —Ñ–∏–∑–∏–∫–µ: —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏,
            –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å. –ù–∞—á–Ω–∏—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É —É–∂–µ —Å–µ–π—á–∞—Å.
          </p>
          <div class="actions">
            <a class="btn" href="/register.html">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
            <a class="btn btn-secondary" href="/login.html">–£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
          </div>
        </section>

        <section id="userSection" hidden>
          <div class="card" style="max-width: 820px; text-align: left;">
            <h2>–ì–æ—Ç–æ–≤—ã –∫ –Ω–æ–≤–æ–º—É —Ç–µ—Å—Ç—É?</h2>
            <p style="color: #cbd5f5; line-height: 1.7;">
              –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, –ø–æ—ç—Ç–æ–º—É –≤–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å 10 –∑–∞–¥–∞—á.
            </p>
            <form id="sessionForm" class="session-form" style="display: grid; gap: 1rem;">
              <label>–†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                <select id="modeSelect" style="width: 100%; padding: 0.75rem; border-radius: 10px; border: 1px solid rgba(148,163,184,0.3); background: rgba(15,23,42,0.6); color: #e2e8f0;">
                  <option value="normal">–û–±—ã—á–Ω—ã–π</option>
                  <option value="timed">–ù–∞ –≤—Ä–µ–º—è</option>
                  <option value="training">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</option>
                </select>
              </label>
              <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
                <input type="number" id="numItems" value="10" min="1" max="50" />
              </label>
              <button class="btn" type="submit">–°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-—Å–µ—Å—Å–∏—é</button>
            </form>
            <pre id="sessionResult" class="log" style="margin-top: 1.5rem; display: none;"></pre>
          </div>
        </section>
      </main>

      <section class="hero" style="padding-top: 0;">
        <div class="card" style="max-width: 820px;">
          <h2>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
          <p style="text-align: left; line-height: 1.7; color: #cbd5f5;">
            <strong>1.</strong> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.<br />
            <strong>2.</strong> –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ù–∞ —Å—Ç–∞—Ä—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ 10 –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏—Ö
            –∑–∞–¥–∞—á, –Ω–æ –±–∞–∑–∞ –∏ —Ä–µ–∂–∏–º—ã –±—É–¥—É—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è.<br />
            <strong>3.</strong> –ü–æ–ª—É—á–∞–π—Ç–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –ø–æ –∫–∞–∂–¥–æ–º—É –æ—Ç–≤–µ—Ç—É, –∞ –∑–∞—Ç–µ–º
            –∏—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.<br />
            <strong>4.</strong> –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
            –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
          </p>
        </div>
      </section>

      <footer class="footer">
        Physics Project ¬∑ –£—á–µ–±–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º —Ä–∞–±–æ—Ç–∞–º –ø–æ —Ñ–∏–∑–∏–∫–µ
      </footer>
    </div>

    <script>
      (function(){
        const storageKey = 'pp_user';

        function getCurrentUser(){
          try { return JSON.parse(localStorage.getItem(storageKey) || 'null'); }
          catch { return null; }
        }

        function setCurrentUser(user){
          if(user) localStorage.setItem(storageKey, JSON.stringify(user));
          else localStorage.removeItem(storageKey);
        }

        function renderState(){
          const user = getCurrentUser();
          const loggedIn = !!(user && user.loggedIn && user.username);

          const guestSection = document.getElementById('guestSection');
          const userSection = document.getElementById('userSection');
          const guestActions = document.getElementById('guestActions');
          const userActions = document.getElementById('userActions');
          const userNameLabel = document.getElementById('userNameLabel');

          if(guestSection) guestSection.hidden = loggedIn;
          if(guestActions) guestActions.hidden = loggedIn;
          if(userSection) userSection.hidden = !loggedIn;
          if(userActions) userActions.hidden = !loggedIn;
          if(userNameLabel) userNameLabel.textContent = loggedIn ? user.username : '';
        }

        async function createDemoSession(numItems){
          const response = await fetch(`/api/demo/create-demo-session?numItems=${numItems}`, {
            method: 'POST'
          });
          if(!response.ok){
            const text = await response.text();
            throw new Error(text || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-—Å–µ—Å—Å–∏—é');
          }
          return response.json();
        }

        document.addEventListener('DOMContentLoaded', () => {
          renderState();

          const logoutBtn = document.getElementById('logoutBtn');
          if(logoutBtn){
            logoutBtn.addEventListener('click', () => {
              setCurrentUser(null);
              renderState();
            });
          }

          const profileBtn = document.getElementById('profileBtn');
          if(profileBtn){
            profileBtn.addEventListener('click', () => {
              alert('–†–∞–∑–¥–µ–ª –ø—Ä–æ—Ñ–∏–ª—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.');
            });
          }

          const sessionForm = document.getElementById('sessionForm');
          const sessionResult = document.getElementById('sessionResult');
          if (sessionForm) {
            sessionForm.addEventListener('submit', (event) => {
              event.preventDefault();
              const numItems = Number(document.getElementById('numItems')?.value || 10);
              const mode = document.getElementById('modeSelect')?.value || 'normal';
              // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–µ—Å—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
              window.location.href = `/test-session.html?numItems=${encodeURIComponent(
                numItems
              )}&mode=${encodeURIComponent(mode)}`;
            });
          }

          const startDemoBtn = document.getElementById('startDemoBtn');
          if (startDemoBtn) {
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–µ—Å—Ç–∞
            startDemoBtn.addEventListener('click', (e) => {
              // –ï—Å–ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–∞, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ;
              // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
              // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã –ø—Ä–∏ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –∫–Ω–æ–ø–∫–∏.
              if (sessionForm) sessionForm.querySelector('[type=submit]')?.blur();
              // —è–≤–Ω–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª—É—á–∞–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
              window.location.href = '/test-session.html';
            });
          }
        });

        window.addEventListener('storage', (event) => {
          if(event.key === storageKey) renderState();
        });
      })();
    </script>
  </body>
</html>

